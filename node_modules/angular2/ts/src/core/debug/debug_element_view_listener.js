System.register(['angular2/src/core/facade/lang', 'angular2/src/core/facade/collection', 'angular2/src/core/di', 'angular2/src/core/linker/view_listener', 'angular2/src/core/dom/dom_adapter', './debug_element'], function(exports_1) {
    var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var lang_1, collection_1, di_1, view_listener_1, dom_adapter_1, debug_element_1;
    var NG_ID_PROPERTY, INSPECT_GLOBAL_NAME, NG_ID_SEPARATOR, _allIdsByView, _allViewsById, _nextId, DebugElementViewListener, ELEMENT_PROBE_PROVIDERS, ELEMENT_PROBE_BINDINGS;
    function _setElementId(element, indices) {
        if (lang_1.isPresent(element)) {
            dom_adapter_1.DOM.setData(element, NG_ID_PROPERTY, indices.join(NG_ID_SEPARATOR));
        }
    }
    function _getElementId(element) {
        var elId = dom_adapter_1.DOM.getData(element, NG_ID_PROPERTY);
        if (lang_1.isPresent(elId)) {
            return elId.split(NG_ID_SEPARATOR).map(partStr => lang_1.NumberWrapper.parseInt(partStr, 10));
        }
        else {
            return null;
        }
    }
    function inspectNativeElement(element) {
        var elId = _getElementId(element);
        if (lang_1.isPresent(elId)) {
            var view = _allViewsById.get(elId[0]);
            if (lang_1.isPresent(view)) {
                return new debug_element_1.DebugElement_(view, elId[1]);
            }
        }
        return null;
    }
    exports_1("inspectNativeElement", inspectNativeElement);
    return {
        setters:[
            function (lang_1_1) {
                lang_1 = lang_1_1;
            },
            function (collection_1_1) {
                collection_1 = collection_1_1;
            },
            function (di_1_1) {
                di_1 = di_1_1;
            },
            function (view_listener_1_1) {
                view_listener_1 = view_listener_1_1;
            },
            function (dom_adapter_1_1) {
                dom_adapter_1 = dom_adapter_1_1;
            },
            function (debug_element_1_1) {
                debug_element_1 = debug_element_1_1;
            }],
        execute: function() {
            const NG_ID_PROPERTY = 'ngid';
            const INSPECT_GLOBAL_NAME = 'ng.probe';
            const NG_ID_SEPARATOR = '#';
            // Need to keep the views in a global Map so that multiple angular apps are supported
            var _allIdsByView = new collection_1.Map();
            var _allViewsById = new collection_1.Map();
            var _nextId = 0;
            let DebugElementViewListener = class {
                constructor(_renderer) {
                    this._renderer = _renderer;
                    dom_adapter_1.DOM.setGlobalVar(INSPECT_GLOBAL_NAME, inspectNativeElement);
                }
                viewCreated(view) {
                    var viewId = _nextId++;
                    _allViewsById.set(viewId, view);
                    _allIdsByView.set(view, viewId);
                    for (var i = 0; i < view.elementRefs.length; i++) {
                        var el = view.elementRefs[i];
                        _setElementId(this._renderer.getNativeElementSync(el), [viewId, i]);
                    }
                }
                viewDestroyed(view) {
                    var viewId = _allIdsByView.get(view);
                    _allIdsByView.delete(view);
                    _allViewsById.delete(viewId);
                }
            };
            DebugElementViewListener = __decorate([
                di_1.Injectable()
            ], DebugElementViewListener);
            DebugElementViewListener = DebugElementViewListener;
            ELEMENT_PROBE_PROVIDERS = lang_1.CONST_EXPR([
                DebugElementViewListener,
                lang_1.CONST_EXPR(new di_1.Provider(view_listener_1.AppViewListener, { useExisting: DebugElementViewListener })),
            ]);
            ELEMENT_PROBE_BINDINGS = ELEMENT_PROBE_PROVIDERS;
        }
    }
});
//# sourceMappingURL=debug_element_view_listener.js.map